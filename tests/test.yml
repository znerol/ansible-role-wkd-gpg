---
- hosts: localhost
  vars:
    wkd_gpg_uids:
      - "Joe.Doe@Example.ORG"
      - "joe.doe@Example.com"
      - "test-wkd@example.org"
      - "me@example.com"
      - "äëöüï@example.org"
      - "foo@example.com"
    wkd_gpg_key_directory: "/tmp/{{ wkd_gpg_uid | wkd_dir(wkd_method='advanced') }}"

  tasks:
    - name: Role znerol.wkd_gpg imported
      import_role:
        name: ../../ansible-role-wkd-gpg

    - name: WKD directory present
      loop: "{{ wkd_gpg_uids | list }}"
      loop_control:
        loop_var: wkd_gpg_uid
      file:
        state: directory
        path: "{{ wkd_gpg_key_directory }}"
        recurse: true

    - name: GPG key exported
      loop: "{{ wkd_gpg_uids | list }}"
      loop_control:
        loop_var: wkd_gpg_uid
      include_role:
        name: ../../ansible-role-wkd-gpg
        tasks_from: wkd_key
